---
alwaysApply: true
---
# Nomur 微商管理系统 - 项目规范

## 项目概述
这是一个基于 uni-app + Vue3 + TypeScript 的微商代理管理小程序，采用双端设计：
- **管理端**：创始人/公司视角，负责商品录入、发货开单、代理管理、财务审核
- **用户端**：代理商视角，查看业绩、余额、任务进度

## 技术栈
- 框架：uni-app (Vue 3 + TypeScript)
- UI库：自定义组件（强调勾选式交互）
- 状态管理：Pinia
- 样式：SCSS + CSS变量
- 构建：Vite

## 核心设计原则

### 1. 交互体验优先（UX First）
- ❌ 禁止使用下拉菜单（Dropdown）
- ✅ 使用平铺勾选框（Checkbox/Tag Grid）
- ✅ 支持多选操作
- ✅ 图片上传无数量限制
- ✅ 实时计算（毫秒级响应）

### 2. 移动端优化
- 大按钮、大触控区域（最小 44px）
- 单手操作友好
- 减少输入，多用选择
- 关键操作不超过3步

### 3. 视觉规范
- 主色：#1890FF（科技蓝）
- 成功：#52C41A
- 警告：#FAAD14
- 危险：#FF4D4F
- 背景：#F5F7FA
- 卡片圆角：12rpx
- 阴影：0 2rpx 12rpx rgba(0,0,0,0.08)

## 目录结构
```
src/
├── components/          # 公共组件
│   ├── TagSelect/       # 勾选标签组件
│   ├── ImageUploader/   # 图片上传组件
│   ├── QuickCalc/       # 实时计算组件
│   └── BalanceCard/     # 余额卡片组件
├── pages/
│   ├── admin/           # 管理端页面
│   │   ├── dashboard/   # 数据驾驶舱
│   │   ├── products/    # 商品管理
│   │   ├── agents/      # 代理管理
│   │   ├── orders/      # 极速开单
│   │   └── finance/     # 财务管理
│   └── agent/           # 代理端页面
│       ├── home/        # 首页（业绩看板）
│       ├── balance/     # 余额明细
│       └── promotions/  # 促销查询
├── stores/              # Pinia状态管理
├── types/               # TypeScript类型定义
├── utils/               # 工具函数
├── api/                 # API请求封装
└── static/              # 静态资源
```

## 数据模型

### 商品 Product
```typescript
interface Product {
  id: string
  name: string
  image: string
  price: number
  weight: number // 单位：kg
  materials: string[] // 素材库图片URLs
  createdAt: Date
}
```

### 代理商 Agent
```typescript
interface Agent {
  id: string
  avatar: string
  name: string
  phone1: string
  phone2?: string
  address: string
  yearlyTargets: {
    productA: number // A产品年度目标（箱）
    mixed: number    // 混合产品年度目标（箱）
  }
  balance: number // 余额（可为负数）
}
```

### 订单 Order
```typescript
interface Order {
  id: string
  agentId: string
  items: OrderItem[]
  totalWeight: number
  totalAmount: number
  driverPhone: string
  promotionId?: string
  giftItems?: GiftItem[]
  status: 'pending' | 'shipped' | 'completed'
  createdAt: Date
}
```

### 资金流水 Transaction
```typescript
interface Transaction {
  id: string
  agentId: string
  type: 'recharge' | 'deduct'
  reason: 'gift' | 'payment' | 'shipping' | 'fine' | 'transfer_in' | 'transfer_out'
  amount: number
  proof?: string // 凭证图片
  relatedOrderId?: string
  createdAt: Date
}
```

## 业务规则

### 促销活动
- 规则：每满100件赠送指定商品
- 需透明展示：已购数量、当前赠品数量

### 调货逻辑（原子操作）
```
A代理 -> B代理 调货
1. 公司退款给A的账户 (+amount)
2. 公司从B的账户扣款 (-amount)
必须使用事务确保两步操作同时成功或失败
```

### 余额显示
- 支持负数显示（欠账状态）
- 负数用红色显示，正数用绿色显示

## 组件开发规范

### TagSelect 标签选择组件
- 必须支持单选/多选模式
- 标签需有选中/未选中明显视觉差异
- 选中时有轻微震动反馈

### ImageUploader 图片上传
- 支持多图上传
- 显示上传进度
- 支持预览和删除
- 压缩后上传（保证速度）

### QuickCalc 实时计算
- 使用 computed 或 watch 实现毫秒级响应
- 数量变化时自动计算：总重量、总费用、运费预估

## API 设计规范
- RESTful 风格
- 统一响应格式：{ code, message, data }
- 错误统一处理
- 请求需带 token 认证

## 代码规范
- 组件名使用 PascalCase
- 文件名使用 kebab-case
- 变量名使用 camelCase
- 常量使用 UPPER_SNAKE_CASE
- 必须添加 TypeScript 类型注解
- 禁止使用 any 类型

### ⚠️ 重要提醒：代码改动后必须重新构建
**每次修改代码后，必须重新构建项目才能生效！**

#### H5 版本构建
- 构建命令：`npm run build:h5`
- 构建目录：`dist/build/h5`
- 部署方式：构建后自动生效（Nginx 已配置）
- 访问地址：https://100nomur.net

#### 微信小程序版本构建
- 构建命令：`npm run build:mp-weixin`
- 构建目录：`dist/build/mp-weixin`
- 部署方式：
  1. 构建完成后，使用微信开发者工具打开构建目录
  2. 在微信开发者工具中上传代码
  3. 提交审核并发布

#### 构建注意事项
- 修改前端代码后，**必须重新构建**才能看到效果
- H5 和小程序需要分别构建
- 小程序构建后需要上传到微信开发者工具才能发布

## Git 提交规范
- feat: 新功能
- fix: 修复bug
- style: 样式调整
- refactor: 重构
- docs: 文档更新

---

## 部署与服务器配置

> 📋 **服务器配置信息**：详细的服务器硬件、软件环境、网络配置等信息请查看 `server-config.mdc` 文件。

### 网络配置
- **域名**: 100nomur.net
- **WWW 子域名**: www.100nomur.net
- **前端访问**: https://100nomur.net
- **API 路由**: `/api/*` (Nginx 反向代理到 http://127.0.0.1:3001)
- **数据库**: MySQL 8.0.44 (localhost, 数据库名: nomur)

### 后端 API 服务配置

| 项目 | 信息 |
|------|------|
| 服务地址 | http://127.0.0.1:3001 |
| 代码目录 | /var/www/nomur/server |
| 入口文件 | server/index.js |
| 进程管理 | PM2 (已配置，已设置开机自启) |
| API 路由 | /api/* (通过 Nginx 反向代理) |
| 数据库 | MySQL 8.0.44 (localhost, 数据库: nomur) |

### 前端服务配置

| 项目 | 信息 |
|------|------|
| 前端类型 | uni-app (Vue3 + TypeScript) |
| H5 构建目录 | /var/www/nomur/dist/build/h5 |
| H5 访问地址 | https://100nomur.net |
| 小程序构建目录 | /var/www/nomur/dist/build/mp-weixin |
| H5 构建命令 | `npm run build:h5` |
| 小程序构建命令 | `npm run build:mp-weixin` |

### SSL 证书配置

- **证书类型**: Let's Encrypt
- **申请工具**: acme.sh (Gitee 镜像安装)
- **证书路径**: /etc/nginx/ssl/100nomur.net.pem
- **证书密钥**: /etc/nginx/ssl/100nomur.net.key
- **证书状态**: ✅ 已配置并启用
- **自动续期**: ✅ 已配置（acme.sh 自动管理）
- **HTTPS**: ✅ 已启用，HTTP 自动重定向到 HTTPS

---

> **注意**: 服务器配置详细信息（硬件、已安装软件、系统信息等）请查看 `server-config.mdc` 文件。
