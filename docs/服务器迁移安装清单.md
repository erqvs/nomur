# Nomur é¡¹ç›®è¿ç§»åˆ°æ–° Ubuntu 22.04 æœåŠ¡å™¨ - å®‰è£…æ¸…å•

## ğŸ“‹ ç³»ç»Ÿç¯å¢ƒè¦æ±‚

- **æ“ä½œç³»ç»Ÿ**ï¼šUbuntu 22.04 LTS
- **æ¶æ„**ï¼šx86_64 (amd64)

---

## ğŸ”§ å¿…éœ€å®‰è£…çš„è½¯ä»¶å’Œå·¥å…·

### 1. ç³»ç»ŸåŸºç¡€å·¥å…·

```bash
# æ›´æ–°ç³»ç»ŸåŒ…
sudo apt update && sudo apt upgrade -y

# å®‰è£…åŸºç¡€å·¥å…·
sudo apt install -y \
    git \
    curl \
    wget \
    vim \
    nano \
    build-essential \
    ufw
```

**è¯´æ˜**ï¼š
- `git`ï¼šç”¨äºä»£ç ç‰ˆæœ¬ç®¡ç†å’Œéƒ¨ç½²
- `curl` / `wget`ï¼šä¸‹è½½å·¥å…·
- `vim` / `nano`ï¼šæ–‡æœ¬ç¼–è¾‘å™¨
- `build-essential`ï¼šç¼–è¯‘å·¥å…·ï¼ˆæŸäº› npm åŒ…éœ€è¦ï¼‰
- `ufw`ï¼šé˜²ç«å¢™ç®¡ç†å·¥å…·

---

### 2. Node.js å’Œ npm

```bash
# å®‰è£… Node.js 20.xï¼ˆé¡¹ç›®è¦æ±‚ç‰ˆæœ¬ï¼š20.19.6ï¼‰
curl -fsSL https://deb.nodesource.com/setup_20.x | sudo -E bash -
sudo apt install -y nodejs

# éªŒè¯å®‰è£…
node --version  # åº”è¯¥æ˜¾ç¤º v20.x.x
npm --version   # åº”è¯¥æ˜¾ç¤º 10.x.x
```

**è¯´æ˜**ï¼š
- é¡¹ç›®ä½¿ç”¨ Node.js 20.19.6ï¼Œä½¿ç”¨å®˜æ–¹æºå®‰è£… 20.x ç‰ˆæœ¬
- npm ä¼šéš Node.js ä¸€èµ·å®‰è£…

---

### 3. PM2 è¿›ç¨‹ç®¡ç†å™¨

```bash
# å…¨å±€å®‰è£… PM2
sudo npm install -g pm2

# éªŒè¯å®‰è£…
pm2 --version

# è®¾ç½® PM2 å¼€æœºè‡ªå¯ï¼ˆéƒ¨ç½²åæ‰§è¡Œï¼‰
pm2 startup
```

**è¯´æ˜**ï¼š
- PM2 ç”¨äºç®¡ç†åç«¯ Node.js æœåŠ¡
- æ”¯æŒè‡ªåŠ¨é‡å¯ã€æ—¥å¿—ç®¡ç†ã€è¿›ç¨‹ç›‘æ§

---

### 4. Nginx Web æœåŠ¡å™¨

```bash
# å®‰è£… Nginx
sudo apt install -y nginx

# å¯åŠ¨å¹¶è®¾ç½®å¼€æœºè‡ªå¯
sudo systemctl start nginx
sudo systemctl enable nginx

# éªŒè¯å®‰è£…
nginx -v
sudo systemctl status nginx
```

**è¯´æ˜**ï¼š
- Nginx ç”¨äºåå‘ä»£ç†å’Œé™æ€æ–‡ä»¶æœåŠ¡
- éœ€è¦é…ç½® SSL è¯ä¹¦å’Œåå‘ä»£ç†è§„åˆ™

---

### 5. SSL è¯ä¹¦ç®¡ç†å·¥å…·ï¼ˆacme.shï¼‰

```bash
# å®‰è£… acme.sh
curl https://get.acme.sh | sh

# é‡æ–°åŠ è½½ shell é…ç½®ï¼ˆæˆ–é‡æ–°ç™»å½•ï¼‰
source ~/.bashrc

# éªŒè¯å®‰è£…
~/.acme.sh/acme.sh --version
```

**è¯´æ˜**ï¼š
- acme.sh ç”¨äºè‡ªåŠ¨ç”³è¯·å’Œç»­æœŸ Let's Encrypt SSL è¯ä¹¦
- æ”¯æŒé˜¿é‡Œäº‘ DNS API éªŒè¯ï¼ˆæ¨èæ–¹å¼ï¼‰

**é…ç½®é˜¿é‡Œäº‘ DNS APIï¼ˆå¯é€‰ï¼Œç”¨äºè‡ªåŠ¨éªŒè¯ï¼‰**ï¼š
```bash
# è®¾ç½®ç¯å¢ƒå˜é‡ï¼ˆéœ€è¦é˜¿é‡Œäº‘ AccessKeyï¼‰
export Ali_Key="your_ali_key"
export Ali_Secret="your_ali_secret"
```

---

### 6. MySQL å®¢æˆ·ç«¯ï¼ˆå¯é€‰ï¼‰

```bash
# å¦‚æœéœ€è¦åœ¨æœåŠ¡å™¨ä¸Šç›´æ¥æ“ä½œæ•°æ®åº“
sudo apt install -y mysql-client

# éªŒè¯å®‰è£…
mysql --version
```

**è¯´æ˜**ï¼š
- é¡¹ç›®ä½¿ç”¨è¿œç¨‹ MySQL æ•°æ®åº“ï¼ˆ8.154.33.100:3306ï¼‰
- å¦‚æœåªéœ€è¦é€šè¿‡åº”ç”¨è¿æ¥ï¼Œå¯ä»¥ä¸å®‰è£…å®¢æˆ·ç«¯

---

## ğŸ§ª æµ‹è¯•å·¥å…·ï¼ˆå¯é€‰ï¼Œç”¨äºè‡ªåŠ¨åŒ–æµ‹è¯•ï¼‰

### 7. Python 3 å’Œ pip

```bash
# Ubuntu 22.04 é€šå¸¸å·²é¢„è£… Python 3.10
python3 --version

# å¦‚æœæ²¡æœ‰ï¼Œå®‰è£… Python 3
sudo apt install -y python3 python3-pip

# å‡çº§ pip
pip3 install --upgrade pip
```

### 8. Python æµ‹è¯•ä¾èµ–

```bash
# è¿›å…¥é¡¹ç›®æµ‹è¯•ç›®å½•
cd /var/www/nomur/tests

# å®‰è£… Python ä¾èµ–
pip3 install -r requirements.txt
```

**requirements.txt å†…å®¹**ï¼š
- `requests>=2.31.0`
- `selenium>=4.0.0`
- `webdriver-manager>=4.0.0`

### 9. Chrome å’Œ ChromeDriverï¼ˆç”¨äº Selenium æµ‹è¯•ï¼‰

```bash
# å®‰è£… Chrome æµè§ˆå™¨
wget https://dl.google.com/linux/direct/google-chrome-stable_current_amd64.deb
sudo dpkg -i google-chrome-stable_current_amd64.deb
sudo apt-get install -f -y  # ä¿®å¤ä¾èµ–

# å®‰è£… ChromeDriver
sudo apt install -y chromium-chromedriver

# æˆ–ä½¿ç”¨ webdriver-managerï¼ˆæ¨èï¼Œè‡ªåŠ¨ç®¡ç†ç‰ˆæœ¬ï¼‰
# å·²åœ¨ requirements.txt ä¸­åŒ…å«
```

**è¯´æ˜**ï¼š
- ä»…ç”¨äºè¿è¡Œè‡ªåŠ¨åŒ–æµ‹è¯•è„šæœ¬
- å¦‚æœä¸éœ€è¦æµ‹è¯•åŠŸèƒ½ï¼Œå¯ä»¥è·³è¿‡

---

## ğŸ“¦ é¡¹ç›®ä¾èµ–å®‰è£…

### 10. å‰ç«¯ä¾èµ–ï¼ˆuni-appï¼‰

```bash
# è¿›å…¥é¡¹ç›®æ ¹ç›®å½•
cd /var/www/nomur

# å®‰è£…å‰ç«¯ä¾èµ–
npm install
```

**ä¸»è¦ä¾èµ–**ï¼š
- `@dcloudio/uni-app`ï¼šuni-app æ¡†æ¶
- `vue`ï¼šVue 3
- `pinia`ï¼šçŠ¶æ€ç®¡ç†
- `vite`ï¼šæ„å»ºå·¥å…·
- `typescript`ï¼šTypeScript æ”¯æŒ
- `sass`ï¼šSCSS ç¼–è¯‘

### 11. åç«¯ä¾èµ–ï¼ˆExpress APIï¼‰

```bash
# è¿›å…¥åç«¯ç›®å½•
cd /var/www/nomur/server

# å®‰è£…åç«¯ä¾èµ–
npm install
```

**ä¸»è¦ä¾èµ–**ï¼š
- `express`ï¼šWeb æ¡†æ¶
- `mysql2`ï¼šMySQL æ•°æ®åº“é©±åŠ¨
- `multer`ï¼šæ–‡ä»¶ä¸Šä¼ å¤„ç†
- `cors`ï¼šè·¨åŸŸæ”¯æŒ
- `uuid`ï¼šå”¯ä¸€ ID ç”Ÿæˆ

---

## ğŸ” ç›®å½•å’Œæƒé™é…ç½®

### 12. åˆ›å»ºå¿…è¦çš„ç›®å½•

```bash
# åˆ›å»º SSL è¯ä¹¦ç›®å½•
sudo mkdir -p /etc/nginx/ssl

# åˆ›å»ºä¸Šä¼ æ–‡ä»¶ç›®å½•ï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰
mkdir -p /var/www/nomur/server/uploads

# è®¾ç½®ä¸Šä¼ ç›®å½•æƒé™
sudo chown -R $USER:$USER /var/www/nomur/server/uploads
chmod -R 755 /var/www/nomur/server/uploads
```

---

## ğŸŒ é˜²ç«å¢™é…ç½®

### 13. é…ç½®é˜²ç«å¢™è§„åˆ™

```bash
# å…è®¸ SSHï¼ˆ22ç«¯å£ï¼Œé»˜è®¤å·²å¼€æ”¾ï¼‰
sudo ufw allow 22/tcp

# å…è®¸ HTTPï¼ˆ80ç«¯å£ï¼‰
sudo ufw allow 80/tcp

# å…è®¸ HTTPSï¼ˆ443ç«¯å£ï¼‰
sudo ufw allow 443/tcp

# å¦‚æœéœ€è¦ç›´æ¥è®¿é—®åç«¯ APIï¼ˆä¸æ¨èï¼Œåº”é€šè¿‡ Nginxï¼‰
# sudo ufw allow 3001/tcp

# å¯ç”¨é˜²ç«å¢™
sudo ufw enable

# æŸ¥çœ‹é˜²ç«å¢™çŠ¶æ€
sudo ufw status
```

---

## âœ… å®‰è£…éªŒè¯æ¸…å•

å®Œæˆå®‰è£…åï¼Œè¯·éªŒè¯ä»¥ä¸‹é¡¹ç›®ï¼š

- [ ] Node.js ç‰ˆæœ¬ï¼š`node --version` æ˜¾ç¤º v20.x.x
- [ ] npm ç‰ˆæœ¬ï¼š`npm --version` æ˜¾ç¤º 10.x.x
- [ ] PM2 å·²å®‰è£…ï¼š`pm2 --version` æœ‰è¾“å‡º
- [ ] Nginx è¿è¡Œä¸­ï¼š`sudo systemctl status nginx` æ˜¾ç¤º active
- [ ] acme.sh å·²å®‰è£…ï¼š`~/.acme.sh/acme.sh --version` æœ‰è¾“å‡º
- [ ] å‰ç«¯ä¾èµ–å·²å®‰è£…ï¼š`cd /var/www/nomur && ls node_modules` æœ‰å†…å®¹
- [ ] åç«¯ä¾èµ–å·²å®‰è£…ï¼š`cd /var/www/nomur/server && ls node_modules` æœ‰å†…å®¹
- [ ] é˜²ç«å¢™å·²é…ç½®ï¼š`sudo ufw status` æ˜¾ç¤º 80, 443 ç«¯å£å·²å¼€æ”¾

---

## ğŸ“ åç»­éƒ¨ç½²æ­¥éª¤

å®‰è£…å®Œä¸Šè¿°è½¯ä»¶åï¼Œè¿˜éœ€è¦ï¼š

1. **éƒ¨ç½²é¡¹ç›®ä»£ç **
   - é€šè¿‡ Git å…‹éš†æˆ–ä¸Šä¼ ä»£ç åˆ° `/var/www/nomur`

2. **é…ç½®æ•°æ®åº“è¿æ¥**
   - ä¿®æ”¹ `server/index.js` ä¸­çš„æ•°æ®åº“è¿æ¥ä¿¡æ¯

3. **ç”³è¯· SSL è¯ä¹¦**
   - ä½¿ç”¨ acme.sh ç”³è¯·åŸŸåè¯ä¹¦

4. **é…ç½® Nginx**
   - åˆ›å»º Nginx é…ç½®æ–‡ä»¶
   - é…ç½®åå‘ä»£ç†å’Œ SSL

5. **å¯åŠ¨åç«¯æœåŠ¡**
   - ä½¿ç”¨ PM2 å¯åŠ¨åç«¯ API

6. **æ„å»ºå‰ç«¯é¡¹ç›®**
   - è¿è¡Œ `npm run build:h5` æ„å»º H5 ç‰ˆæœ¬

è¯¦ç»†éƒ¨ç½²æ­¥éª¤è¯·å‚è€ƒï¼š`docs/äº‘æœåŠ¡å™¨é€‰å‹ä¸éƒ¨ç½²æŒ‡å—.md`

---

## ğŸ”— ç›¸å…³æ–‡æ¡£

- **éƒ¨ç½²æŒ‡å—**ï¼š`docs/äº‘æœåŠ¡å™¨é€‰å‹ä¸éƒ¨ç½²æŒ‡å—.md`
- **é¡¹ç›®è§„èŒƒ**ï¼š`.cursor/rules/rules.mdc`
- **æ“ä½œæŒ‡å—**ï¼š`docs/é¡¹ç›®æ“ä½œå®æˆ˜æŒ‡å—.md`

---

## ğŸ’¡ å¿«é€Ÿå®‰è£…è„šæœ¬ï¼ˆä¸€é”®å®‰è£…ï¼‰

å¦‚æœéœ€è¦å¿«é€Ÿå®‰è£…æ‰€æœ‰å¿…éœ€è½¯ä»¶ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹è„šæœ¬ï¼š

```bash
#!/bin/bash
# ä¿å­˜ä¸º install-dependencies.sh

set -e

echo "ğŸš€ å¼€å§‹å®‰è£… Nomur é¡¹ç›®ä¾èµ–..."

# 1. æ›´æ–°ç³»ç»Ÿ
echo "ğŸ“¦ æ›´æ–°ç³»ç»ŸåŒ…..."
sudo apt update && sudo apt upgrade -y

# 2. å®‰è£…åŸºç¡€å·¥å…·
echo "ğŸ”§ å®‰è£…åŸºç¡€å·¥å…·..."
sudo apt install -y git curl wget vim nano build-essential ufw

# 3. å®‰è£… Node.js 20.x
echo "ğŸ“¦ å®‰è£… Node.js 20.x..."
curl -fsSL https://deb.nodesource.com/setup_20.x | sudo -E bash -
sudo apt install -y nodejs

# 4. å®‰è£… PM2
echo "âš™ï¸ å®‰è£… PM2..."
sudo npm install -g pm2

# 5. å®‰è£… Nginx
echo "ğŸŒ å®‰è£… Nginx..."
sudo apt install -y nginx
sudo systemctl enable nginx

# 6. å®‰è£… acme.sh
echo "ğŸ” å®‰è£… acme.sh..."
curl https://get.acme.sh | sh

# 7. å®‰è£… MySQL å®¢æˆ·ç«¯ï¼ˆå¯é€‰ï¼‰
echo "ğŸ—„ï¸ å®‰è£… MySQL å®¢æˆ·ç«¯..."
sudo apt install -y mysql-client

# 8. é…ç½®é˜²ç«å¢™
echo "ğŸ”¥ é…ç½®é˜²ç«å¢™..."
sudo ufw allow 22/tcp
sudo ufw allow 80/tcp
sudo ufw allow 443/tcp
sudo ufw --force enable

echo "âœ… æ‰€æœ‰ä¾èµ–å®‰è£…å®Œæˆï¼"
echo ""
echo "ğŸ“‹ è¯·éªŒè¯å®‰è£…ï¼š"
echo "  - Node.js: node --version"
echo "  - npm: npm --version"
echo "  - PM2: pm2 --version"
echo "  - Nginx: sudo systemctl status nginx"
echo "  - acme.sh: ~/.acme.sh/acme.sh --version"
```

**ä½¿ç”¨æ–¹æ³•**ï¼š
```bash
# ä¿å­˜è„šæœ¬
nano install-dependencies.sh

# æ·»åŠ æ‰§è¡Œæƒé™
chmod +x install-dependencies.sh

# è¿è¡Œè„šæœ¬
./install-dependencies.sh
```

---

**æœ€åæ›´æ–°**ï¼š2024-12-20

