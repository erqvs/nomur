"use strict";const e=require("../../../common/vendor.js"),t=require("../../../common/assets.js"),a=e.defineComponent({__name:"index",setup(a){const i=e.ref([]),n=e.ref(!1),o=e.ref(null),l=e.ref({name:"",minWeight:0,maxWeight:0,isDefault:!1}),s=async()=>{try{const t=(await e.index.request({url:"https://nomur.linkmate.site/api/truck-types",method:"GET"})).data;0===t.code&&(i.value=t.data)}catch(t){console.error("加载车型失败",t),e.index.showToast({title:"加载失败",icon:"none"})}},u=()=>{o.value=null,l.value={name:"",minWeight:0,maxWeight:0,isDefault:!1},n.value=!0},m=e=>{const t=i.value.find(t=>t.id===e);t&&(o.value=t,l.value={name:t.name,minWeight:t.minWeight,maxWeight:t.maxWeight,isDefault:t.isDefault},n.value=!0)},c=async()=>{if(l.value.name&&""!==l.value.name.trim())if(!l.value.minWeight||l.value.minWeight<=0)e.index.showToast({title:"请输入最小载重",icon:"none"});else if(!l.value.maxWeight||l.value.maxWeight<=0)e.index.showToast({title:"请输入最大载重",icon:"none"});else if(l.value.minWeight>=l.value.maxWeight)e.index.showToast({title:"最小载重必须小于最大载重",icon:"none"});else try{if(o.value){const t=(await e.index.request({url:`https://nomur.linkmate.site/api/truck-types/${o.value.id}`,method:"PUT",data:{name:l.value.name.trim(),minWeight:l.value.minWeight,maxWeight:l.value.maxWeight,isDefault:l.value.isDefault}})).data;0===t.code?(e.index.showToast({title:"更新成功",icon:"success"}),n.value=!1,await s()):e.index.showToast({title:t.message||"更新失败",icon:"none"})}else{const t=(await e.index.request({url:"https://nomur.linkmate.site/api/truck-types",method:"POST",data:{name:l.value.name.trim(),minWeight:l.value.minWeight,maxWeight:l.value.maxWeight,isDefault:l.value.isDefault}})).data;0===t.code?(e.index.showToast({title:"添加成功",icon:"success"}),n.value=!1,await s()):e.index.showToast({title:t.message||"添加失败",icon:"none"})}}catch(t){console.error("保存车型失败",t),e.index.showToast({title:"保存失败",icon:"none"})}else e.index.showToast({title:"请输入车型名称",icon:"none"})};return e.onMounted(()=>{s()}),(a,r)=>e.e({a:e.f(i.value,(t,a,i)=>e.e({a:e.t(t.name),b:t.isDefault},(t.isDefault,{}),{c:e.t(t.minWeight.toLocaleString()),d:e.t(t.maxWeight.toLocaleString()),e:e.o(e=>m(t.id),t.id),f:e.o(a=>{return i=t.id,n=t.name,void e.index.showModal({title:"删除车型",content:`确定要删除车型"${n}"吗？`,confirmText:"删除",confirmColor:"#FF4D4F",success:async t=>{if(t.confirm)try{const t=(await e.index.request({url:`https://nomur.linkmate.site/api/truck-types/${i}`,method:"DELETE"})).data;0===t.code?(e.index.showToast({title:"删除成功",icon:"success"}),await s()):e.index.showToast({title:t.message||"删除失败",icon:"none"})}catch(a){console.error("删除车型失败",a),e.index.showToast({title:"删除失败",icon:"none"})}}});var i,n},t.id),g:t.id,h:e.o(e=>m(t.id),t.id)})),b:t._imports_0$5,c:t._imports_1$6,d:0===i.value.length},0===i.value.length?{e:t._imports_2$3}:{},{f:e.o(u),g:n.value},n.value?e.e({h:e.t(o.value?"编辑车型":"添加车型"),i:l.value.name,j:e.o(e=>l.value.name=e.detail.value),k:l.value.minWeight,l:e.o(e.m(e=>l.value.minWeight=e.detail.value,{number:!0})),m:l.value.maxWeight,n:e.o(e.m(e=>l.value.maxWeight=e.detail.value,{number:!0})),o:l.value.isDefault},(l.value.isDefault,{}),{p:l.value.isDefault?1:"",q:e.o(e=>l.value.isDefault=!l.value.isDefault),r:e.o(e=>n.value=!1),s:e.o(c),t:e.o(()=>{}),v:e.o(e=>n.value=!1)}):{})}}),i=e._export_sfc(a,[["__scopeId","data-v-74e3ff52"]]);wx.createPage(i);
