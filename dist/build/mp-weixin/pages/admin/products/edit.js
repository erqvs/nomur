"use strict";const e=require("../../../common/vendor.js"),a=require("../../../stores/app.js"),i=require("../../../utils/upload.js");Math||(t+o)();const t=()=>"../../../components/QuickInput/index.js",o=()=>"../../../components/ImageUploader/index.js",s=e.defineComponent({__name:"edit",setup(t){const o=a.useAppStore(),s=e.ref(""),l=e.computed(()=>!!s.value),n=e.ref({name:"",image:"",price:0,weight:0,materials:[]});e.onLoad(e=>{if(null==e?void 0:e.id){s.value=e.id;const a=o.products.find(a=>a.id===e.id);a&&(n.value={name:a.name,image:a.image,price:a.price,weight:a.weight,materials:[...a.materials]})}});const u=async()=>{e.index.chooseImage({count:1,sizeType:["compressed"],sourceType:["album","camera"],success:async a=>{try{const t=await i.uploadImage(a.tempFilePaths[0]);n.value.image=t,e.index.showToast({title:"图片上传成功",icon:"success"})}catch(t){e.index.showToast({title:t.message||"图片上传失败",icon:"none"})}}})},c=async()=>{if(n.value.name&&""!==n.value.name.trim())if(void 0===n.value.price||null===n.value.price||n.value.price<=0)e.index.showToast({title:"请输入商品价格",icon:"none"});else if(void 0===n.value.weight||null===n.value.weight||n.value.weight<=0)e.index.showToast({title:"请输入商品重量",icon:"none"});else try{l.value?await o.updateProduct(s.value,n.value):await o.addProduct(n.value),e.index.showToast({title:l.value?"修改成功":"添加成功",icon:"success"}),setTimeout(()=>{e.index.navigateBack()},1500)}catch(a){e.index.showToast({title:a.message||"保存失败",icon:"none"})}else e.index.showToast({title:"请输入商品名称",icon:"none"})},d=()=>{e.index.showModal({title:"确认删除",content:`确定要删除商品"${n.value.name}"吗？删除后无法恢复。`,confirmText:"删除",confirmColor:"#FF4D4F",success:async a=>{if(a.confirm)try{await o.deleteProduct(s.value),e.index.showToast({title:"删除成功",icon:"success"}),setTimeout(()=>{e.index.navigateBack()},1500)}catch(i){e.index.showToast({title:i.message||"删除失败",icon:"none"})}}})};return(a,i)=>e.e({a:n.value.image},n.value.image?{b:n.value.image}:{},{c:e.o(u),d:e.o(e=>n.value.name=e),e:e.p({label:"商品名称",placeholder:"请输入商品名称",required:!0,modelValue:n.value.name}),f:e.o(e=>n.value.price=e),g:e.p({label:"商品价格",placeholder:"请输入价格",type:"digit",prefix:"¥",suffix:"元/箱",required:!0,modelValue:n.value.price}),h:e.o(e=>n.value.weight=e),i:e.p({label:"商品重量",placeholder:"请输入重量",type:"digit",suffix:"kg/箱",required:!0,showQuickNumbers:!0,quickNumbers:[1.5,2,2.5,3,3.5,4],modelValue:n.value.weight}),j:e.o(e=>n.value.materials=e),k:e.p({addText:"添加素材",tip:"支持多张图片上传",modelValue:n.value.materials}),l:e.t(l.value?"保存修改":"添加商品"),m:e.o(c),n:l.value},l.value?{o:e.o(d)}:{})}}),l=e._export_sfc(s,[["__scopeId","data-v-16f0bc81"]]);wx.createPage(l);
