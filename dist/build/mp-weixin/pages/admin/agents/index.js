"use strict";const e=require("../../../common/vendor.js"),a=require("../../../common/assets.js"),l=require("../../../stores/app.js"),u=require("../../../api/index.js"),t=e.defineComponent({__name:"index",setup(t){const n=l.useAppStore(),v=e.ref(""),i=e.ref(!1),o=e.ref(-1),r=e.ref([]),s=e.ref(!1),d=e.ref(-1),c=e.ref(0),p=e.ref(0),h=e.ref(0),f=e.ref(0),g=e.ref(0),m=e.ref(0),x=e.ref(0),w=e.ref(0),_=e.ref(0),b=e.ref(0),S=e.ref([]),y=e.ref(-1),$=e.computed(()=>{if(!v.value)return n.agents;const e=v.value.toLowerCase();return n.agents.filter(a=>a.name.toLowerCase().includes(e)||a.phone1.includes(e)||a.phone2&&a.phone2.includes(e))}),L=e.computed(()=>i.value?r.value:s.value?S.value:$.value),M=e.computed(()=>-1===d.value?null:S.value[d.value]),T=e.computed(()=>-1===d.value?"":{position:"fixed",left:`${g.value}px`,top:`${m.value}px`,width:`${_.value}px`,height:`${b.value}px`,zIndex:"999",opacity:"0.9",boxShadow:"0 12px 40px rgba(0, 0, 0, 0.3)",transform:"scale(1.05)",transition:"none",pointerEvents:"none"}),j=e=>{const a=Math.abs(e).toLocaleString("zh-CN",{minimumFractionDigits:2,maximumFractionDigits:2});return e<0?`-${a}`:a},q=a=>{e.index.navigateTo({url:`/pages/admin/agents/detail?id=${a}`})},A=()=>{e.index.navigateTo({url:"/pages/admin/agents/edit"})},k=()=>{i.value=!1,o.value=-1,r.value=[]},C=e=>e>=2,I=e=>e<r.value.length-2,P=e=>e%2==1,z=e=>e%2==0&&e<r.value.length-1,D=(a,l)=>{if(a<0||a>=r.value.length)return;let u=a;switch(l){case"up":if(!C(a))return;u=a-2;break;case"down":if(!I(a))return;u=a+2;break;case"left":if(!P(a))return;u=a-1;break;case"right":if(!z(a))return;u=a+1}if(u<0||u>=r.value.length)return;const t=[...r.value],[n]=t.splice(a,1);t.splice(u,0,n),r.value=t,o.value=u,e.index.vibrateShort()},E=async()=>{try{e.index.showLoading({title:"保存中..."});const a=r.value.map((e,a)=>({id:e.id,sortOrder:a+1}));await u.agentApi.updateSort(a),await n.loadAgents(),i.value=!1,o.value=-1,r.value=[],e.index.hideLoading(),e.index.showToast({title:"排序已保存",icon:"success"})}catch(a){e.index.hideLoading(),e.index.showToast({title:a instanceof Error?a.message:"保存失败",icon:"none"})}},X=()=>{s.value=!1,S.value=[],d.value=-1,y.value=-1},Y=(e,a)=>{s.value&&(e.stopPropagation(),d.value=-1,y.value=-1)},F=async()=>{try{e.index.showLoading({title:"保存中..."});const a=S.value.map((e,a)=>({id:e.id,sortOrder:a+1}));await u.agentApi.updateSort(a),await n.loadAgents(),s.value=!1,S.value=[],e.index.hideLoading(),e.index.showToast({title:"排序已保存",icon:"success"})}catch(a){e.index.hideLoading(),e.index.showToast({title:a instanceof Error?a.message:"保存失败",icon:"none"})}};return e.onShow(async()=>{await n.loadAgents(),i.value&&(i.value=!1,o.value=-1,r.value=[]),s.value&&(s.value=!1,S.value=[])}),(l,u)=>e.e({a:a._imports_0$2,b:v.value,c:e.o(e=>v.value=e.detail.value),d:i.value},i.value?{e:e.o(E),f:e.o(k)}:{},{g:s.value},s.value?{h:e.o(F),i:e.o(X)}:{},{j:e.f(L.value,(l,u,t)=>e.e({a:e.t(l.name),b:e.t(j(l.balance)),c:l.balance<0?1:"",d:i.value&&o.value===u},i.value&&o.value===u?{e:a._imports_1$4,f:C(u)?"":1,g:e.o(e=>D(u,"up"),l.id),h:a._imports_0$4,i:P(u)?"":1,j:e.o(e=>D(u,"left"),l.id),k:a._imports_2,l:z(u)?"":1,m:e.o(e=>D(u,"right"),l.id),n:a._imports_0$3,o:I(u)?"":1,p:e.o(e=>D(u,"down"),l.id)}:{},(s.value,{}),{q:l.id,r:d.value===u?1:"",s:i.value&&o.value===u?1:"",t:e.o(a=>((a,l)=>{if(!s.value)return;a.stopPropagation();const u=a.touches[0];c.value=u.clientX,p.value=u.clientY,h.value=u.clientX,f.value=u.clientY;const t=e.index.getSystemInfoSync().windowWidth,n=24*t/375,v=20*t/375;_.value=(t-2*n-v)/2,b.value=120*t/375;const i=Math.floor(l/2),o=l%2;x.value=n+o*(_.value+v);const r=76*t/375+80*t/375+n;w.value=r+i*(b.value+v),g.value=x.value,m.value=w.value,d.value=l,y.value=-1})(a,u),l.id),v:e.o(a=>(a=>{if(!s.value||-1===d.value)return;a.stopPropagation(),a.preventDefault();const l=a.touches[0];h.value=l.clientX,f.value=l.clientY;const u=h.value-c.value,t=f.value-p.value;g.value=x.value+u,m.value=w.value+t;const n=g.value+_.value/2,v=m.value+b.value/2,i=e.index.getSystemInfoSync().windowWidth,o=24*i/375,r=20*i/375,$=76*i/375+80*i/375+o,L=Math.floor((n-o)/(_.value+r)),M=Math.floor((v-$)/(b.value+r)),T=Math.max(0,Math.min(1,L)),j=2*Math.max(0,M)+T,q=d.value;if(j>=0&&j<S.value.length&&j!==q&&j!==y.value){const a=[...S.value],[l]=a.splice(q,1);a.splice(j,0,l),S.value=a,d.value=j,y.value=q;const u=Math.floor(j/2),t=j%2;x.value=o+t*(_.value+r),w.value=$+u*(b.value+r),c.value=h.value,p.value=f.value,e.index.vibrateShort()}})(a),l.id),w:e.o(e=>Y(e),l.id),x:e.o(e=>Y(e),l.id),y:e.o(e=>((e,a)=>{i.value?o.value===a?o.value=-1:o.value=a:s.value||q(e)})(l.id,u),l.id),z:e.o(a=>(a=>{v.value?e.index.showToast({title:"请先清除搜索条件",icon:"none"}):0!==$.value.length&&(i.value=!0,r.value=[...$.value],o.value=a,e.index.vibrateShort())})(u),l.id)})),k:s.value,l:s.value?1:"",m:i.value?1:"",n:i.value?1:"",o:s.value?1:"",p:-1!==d.value&&M.value},-1!==d.value&&M.value?{q:e.t(M.value.name),r:e.t(j(M.value.balance)),s:M.value.balance<0?1:"",t:e.s(T.value)}:{},{v:0===$.value.length},0===$.value.length?{w:a._imports_1$3,x:e.t(v.value?"未找到匹配的代理商":"暂无代理商")}:{},{y:e.o(A)})}}),n=e._export_sfc(t,[["__scopeId","data-v-a79eabd5"]]);wx.createPage(n);
