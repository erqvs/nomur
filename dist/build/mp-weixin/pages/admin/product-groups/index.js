"use strict";const e=require("../../../common/vendor.js"),t=require("../../../common/assets.js"),o=require("../../../stores/app.js"),a=require("../../../api/index.js"),i=e.defineComponent({__name:"index",setup(i){const n=o.useAppStore(),s=e.ref([]),d=e.computed(()=>n.products),u=e.ref(!1),c=e.ref(!1),r=e.ref(null),l=e.ref({name:"",description:"",productIds:[]});e.onMounted(async()=>{await p(),0===n.products.length&&await n.loadProducts()}),e.onShow(async()=>{await p()});const p=async()=>{try{s.value=await a.productGroupApi.getAll()}catch(t){console.error("加载产品组合失败:",t),e.index.showToast({title:"加载失败",icon:"none"})}},v=e=>{const t=d.value.find(t=>t.id===e);return(null==t?void 0:t.name)||e},m=e=>l.value.productIds.includes(e),h=(e,t)=>{t&&t.stopPropagation(),r.value=e,l.value={name:e.name,description:e.description||"",productIds:[...e.productIds]},c.value=!0},f=()=>{u.value=!1,c.value=!1,r.value=null,l.value={name:"",description:"",productIds:[]}},w=async()=>{if(l.value.name&&""!==l.value.name.trim())if(0!==l.value.productIds.length)try{r.value?(await a.productGroupApi.update(r.value.id,{name:l.value.name.trim(),description:l.value.description.trim(),productIds:l.value.productIds}),e.index.showToast({title:"更新成功",icon:"success"})):(await a.productGroupApi.create({name:l.value.name.trim(),description:l.value.description.trim(),productIds:l.value.productIds}),e.index.showToast({title:"创建成功",icon:"success"})),f(),await p()}catch(t){e.index.showToast({title:t.message||"保存失败",icon:"none"})}else e.index.showToast({title:"请至少选择一个产品",icon:"none"});else e.index.showToast({title:"请输入组合名称",icon:"none"})};return(o,i)=>e.e({a:e.f(s.value,(t,o,i)=>e.e({a:e.t(t.name),b:e.o(e=>h(t,e),t.id),c:e.o(o=>(async(t,o)=>{o.stopPropagation(),e.index.showModal({title:"确认删除",content:"删除后，使用该组合的年度目标和促销活动将受影响，确定要删除吗？",confirmText:"删除",confirmColor:"#FF4D4F",success:async o=>{if(o.confirm)try{await a.productGroupApi.delete(t),e.index.showToast({title:"删除成功",icon:"success"}),await p()}catch(i){e.index.showToast({title:i.message||"删除失败",icon:"none"})}}})})(t.id,o),t.id),d:e.o(()=>{},t.id),e:t.description},t.description?{f:e.t(t.description)}:{},{g:e.f(t.productIds,(t,o,a)=>({a:e.t(v(t)),b:t})),h:t.id,i:e.o(e=>h(t),t.id)})),b:0===s.value.length},0===s.value.length?{c:t._imports_0$7}:{},{d:e.o(e=>u.value=!0),e:u.value||c.value},u.value||c.value?e.e({f:e.t(r.value?"编辑产品组合":"添加产品组合"),g:l.value.name,h:e.o(e=>l.value.name=e.detail.value),i:l.value.description,j:e.o(e=>l.value.description=e.detail.value),k:e.f(d.value,(t,o,a)=>e.e({a:m(t.id)},(m(t.id),{}),{b:e.t(t.name),c:e.o(e=>(e=>{const t=l.value.productIds.indexOf(e);t>-1?l.value.productIds.splice(t,1):l.value.productIds.push(e)})(t.id),t.id),d:t.id,e:m(t.id)?1:""})),l:0===l.value.productIds.length},0===l.value.productIds.length?{}:{m:e.t(l.value.productIds.length)},{n:e.o(f),o:e.o(w),p:e.o(()=>{}),q:e.o(f)}):{})}}),n=e._export_sfc(i,[["__scopeId","data-v-c26f736b"]]);wx.createPage(n);
