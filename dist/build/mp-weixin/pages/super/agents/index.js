"use strict";const e=require("../../../common/vendor.js"),a=require("../../../common/assets.js"),t=require("../../../stores/app.js"),l=require("../../../api/index.js");Math||u();const u=()=>"../../../components/CustomTabBar/index.js",n=e.defineComponent({__name:"index",setup(u){const n=t.useAppStore(),o=e.ref(""),v=e.ref(!1),i=e.ref(-1),r=e.ref(0),s=e.ref(0),c=e.ref(0),d=e.ref(0),p=e.ref(0),f=e.ref(0),h=e.ref(0),g=e.ref(0),m=e.ref(0),x=e.ref(0),w=e.ref([]),b=e.ref(-1),M=e.computed(()=>{if(!o.value)return n.agents;const e=o.value.toLowerCase();return n.agents.filter(a=>a.name.toLowerCase().includes(e)||a.phone1.includes(e)||a.phone2&&a.phone2.includes(e))}),S=e.computed(()=>v.value?w.value:M.value),_=e.computed(()=>-1===i.value?null:w.value[i.value]),y=e.computed(()=>-1===i.value?"":{position:"fixed",left:`${p.value}px`,top:`${f.value}px`,width:`${m.value}px`,height:`${x.value}px`,zIndex:"999",opacity:"0.9",boxShadow:"0 12px 40px rgba(0, 0, 0, 0.3)",transform:"scale(1.05)",transition:"none",pointerEvents:"none"}),$=e=>{const a=Math.abs(e).toLocaleString("zh-CN",{minimumFractionDigits:2,maximumFractionDigits:2});return e<0?`-${a}`:a},j=()=>{e.index.navigateTo({url:"/pages/admin/agents/edit"})},C=()=>{},L=()=>{v.value=!1,w.value=[],i.value=-1,dragOffsetX.value=0,dragOffsetY.value=0,b.value=-1},q=(e,a)=>{v.value&&(e.stopPropagation(),i.value=-1,b.value=-1)},P=async()=>{try{e.index.showLoading({title:"保存中..."});const a=w.value.map((e,a)=>({id:e.id,sortOrder:a+1}));await l.agentApi.updateSort(a),await n.loadAgents(),v.value=!1,w.value=[],e.index.hideLoading(),e.index.showToast({title:"排序已保存",icon:"success"})}catch(a){e.index.hideLoading(),e.index.showToast({title:a instanceof Error?a.message:"保存失败",icon:"none"})}},T=()=>{try{const a=getCurrentPages();if(a.length>0){const t="/"+a[a.length-1].route;e.index.$emit("update-tabbar-path",t)}}catch(a){console.error("更新 tabbar 路径失败:",a)}};return e.onMounted(()=>{T()}),e.onShow(async()=>{T(),await n.loadAgents(),v.value&&(v.value=!1,w.value=[])}),(t,l)=>e.e({a:a._imports_0$2,b:o.value,c:e.o(e=>o.value=e.detail.value),d:v.value},v.value?{e:e.o(P),f:e.o(L)}:{},{g:e.f(S.value,(a,t,l)=>e.e({a:e.t(a.name),b:e.t($(a.balance)),c:a.balance<0?1:""},(v.value,{}),{d:a.id,e:i.value===t?1:"",f:e.o(a=>((a,t)=>{if(!v.value)return;a.stopPropagation();const l=a.touches[0];r.value=l.clientX,s.value=l.clientY,c.value=l.clientX,d.value=l.clientY;const u=e.index.getSystemInfoSync().windowWidth,n=24*u/375,o=20*u/375;m.value=(u-2*n-o)/2,x.value=120*u/375;const w=Math.floor(t/2),M=t%2;h.value=n+M*(m.value+o);const S=76*u/375+80*u/375+n;g.value=S+w*(x.value+o),p.value=h.value,f.value=g.value,i.value=t,b.value=-1})(a,t),a.id),g:e.o(a=>(a=>{if(!v.value||-1===i.value)return;a.stopPropagation(),a.preventDefault();const t=a.touches[0];c.value=t.clientX,d.value=t.clientY;const l=c.value-r.value,u=d.value-s.value;p.value=h.value+l,f.value=g.value+u;const n=p.value+m.value/2,o=f.value+x.value/2,M=e.index.getSystemInfoSync().windowWidth,S=24*M/375,_=20*M/375,y=76*M/375+80*M/375+S,$=Math.floor((n-S)/(m.value+_)),j=Math.floor((o-y)/(x.value+_)),C=Math.max(0,Math.min(1,$)),L=2*Math.max(0,j)+C,q=i.value;if(L>=0&&L<w.value.length&&L!==q&&L!==b.value){const a=[...w.value],[t]=a.splice(q,1);a.splice(L,0,t),w.value=a,i.value=L,b.value=q;const l=Math.floor(L/2),u=L%2;h.value=S+u*(m.value+_),g.value=y+l*(x.value+_),r.value=c.value,s.value=d.value,e.index.vibrateShort()}})(a),a.id),h:e.o(e=>q(e),a.id),i:e.o(e=>q(e),a.id),j:e.o(t=>{return!v.value&&(l=a.id,void(v.value||e.index.navigateTo({url:`/pages/admin/agents/detail?id=${l}`})));var l},a.id),k:e.o(C,a.id)})),h:v.value,i:v.value?1:"",j:v.value?1:"",k:-1!==i.value&&_.value},-1!==i.value&&_.value?{l:e.t(_.value.name),m:e.t($(_.value.balance)),n:_.value.balance<0?1:"",o:e.s(y.value)}:{},{p:0===M.value.length},0===M.value.length?{q:a._imports_1$3,r:e.t(o.value?"未找到匹配的代理商":"暂无代理商")}:{},{s:e.o(j)})}}),o=e._export_sfc(n,[["__scopeId","data-v-599d9864"]]);wx.createPage(o);
